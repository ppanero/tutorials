# Modern React with Redux

The original course code generated by Stephen Grider can be foung in [GitHub](https://github.com/StephenGrider/redux-code).

Inside the example-app folder you can find all the applications developed during the version of the course I took. A brief description of each of them and what is their purpouse can be found in the [example-app README file](./example-app/README.md)

The following sections are the notes I took during the course.

## Helpful tools

Tools that can help during development:

- ``json-server`` allows to create a dummy REST API returning JSON data from the ``db.json`` file (set up by us). For that change the ``package.json`` script to:
    ``` json
        "scripts": {
            "start": "json-server -p 3001 -w db.json"
        },
    ```
## Concepts

- A **React Object** is *something* that goes in between braces. For example ``objectOne = {}``.
- A **React Component** can be built from a JavaScript function or a class. They allow us to show content on the screen, handle an event, etc.
- **React DOM** knows how to take a component and make it show up in the DOM.
- **JSX** is JavaScript dialect that allows us to write normal HTML to be interpreted by a React App.
- **Babel** is a JS package that translates JS code from one standard (e.g. ES2015) into a less modern and more supported one (e.g. ES5). 

## Directories

- **Src** contains all the source code of the application.
- **Public** stores static files (Images, etc.).
- **package.json** records our project dependencies and configures our project.
- **package-lock.json** records the *exact* version of packages that our project installs.
- node_modules, README.md...

Inside the ``src`` directory, the project usually follows this structure of directories, whose names are self explanatory:

- ``actions`` folder
- ``reducers`` folder
- ``components`` folder
- ``apis`` folder
- ``index.js`` file

## Conventions

**Strings quotation**:
- Double quotes are used for strings (labels, IDs, types, etc.).
- Single quotes are used for non JSX properties (styles, etc.).

**CSS**:
- ``class`` is a reserved keyword. Therefore the ``class`` property changes by ``className``.

**Names casing**:
- Property names (including CSS properties) are written without dashes, in camelCase (First letter lowercase).
- Redux action types are written in capital letters, with underscores instead of spaces and avoiding prepositions.
- Components are located in a file with its same name. If they can be shown on the screen their name is writen in PascalCase (First letter uppercase). Otherwise, they are functions and start by lowercase.

**Component Lists**:
- Component lists elements must have an **unique id**, in the **key** property, to ensure correct behaviour on reorder/update operations.
- ``...`` is a flattening operation, similar to ``**`` in Python.
  ``` JavaScript
  arrayOne = [1, 2, 3]
  arrayTwo = [...arrayOne, 4]
  console.log(arrayTwo) --> [1, 2, 3, 4]
  ```

**Imports**:
- When importing, if no file is specified the ``index`` in the root of the directory will be called.
- Import statements for packages or libraries go above local files.

**Redux**:
- Always return new elements in a reducer, never modify existing data (e.g. never do ``array.push(newElement)`` since it would modify the source array).
  

## Troubleshooting

- **Objects are not valid as a React child** happens when you are trying to show a react object as text (inside a react component).
- **this** is the one that calls the function e.g. ``truck.getSound()``, ``this`` becomes ``truck``, and therefore every call to ``this`` inside the ``getSound()`` function will reference to ``truck``. If there is nothing calling the function (e.g. ``getSound()``) ``this`` will resolve to ``undefined``. This is the case in event handlers since inside JS the ``this`` specified during assignment of the handler is "ripped off" at some point calling the function without it (and causing the ``undefined`` error).
- Events are propagated to the parents if the child does not have an event handler. For example in the modals, use ``stopPropagation`` to solve this issue.
- If a function is getting called everytime instead of once some event happens, it has to be transformed into an arrow function ``() => {}``.
- Callback functions have to be defined as arrow funtions to be able to be hooked and mantain the corresponding context (e.g. reference to ``this``).
- Do not call ``setState`` inside ``componentDidUpdate`` because it will trigger a component update, resulting in an endless update/component re-render loop. This can be fixed by adding a check using ``prevProps`` or refactoring the class to be a functional component alog with ``useEffect``.
- Semantic UI hides error messages by default. We have to add the class name "error" to the component in order for them to be shown.

## React

### JSX

First curly braces to specify that we are going to reference a JS variable. The second curly braces is for the JS object itself.

``` JavaScript
style={{backgroundColor: 'red'}}
```

### CSS and styling

- Add CSS stylesheets by using a CDN in a ``link`` element inside the ``public/index.html``.
- `${icon} test` is a string template, it will get whatever is inside (value) of ``icon`` and put it inside the screen.

### Components

- Nesting: Place one or more components inside others.
- Reusability: Be able to reuse the code of them.
- Configuration: Make them configurable.
- To make components available in other files we need to ``export`` them.
- Lifecycle: 
  - ``constructor``: Created. Guidelines advice not to do data loading here.
  - ``render``: Shown in the browser. Avoid doing anything but returning JSX code (No network, no heavy actions). Avoid doing conditional rendering.
  - ``componentDidMount``: Called only the first time the component shows up.
  - ``componentDidUpdate``: Called each time the component gets updated, right after the ``render`` method.
  - ``componentWillUnmount``: Call only the last time before unmounting the component.

  Others (rarely used ones): ``shouldComponentUdate``, ``getDerivedStateFromProps`` and ``getSnapshotBeforeUpdate``. 

#### Class

- Easier to understand.
- Can use ``state`` --> Easier to handle user input.
- Understand lifecycle events --> Easier to do start-up tasks.
- When in need of callback results affecting what's displayed in the page.
- Communication child-parent via callbacks passed via ``props``.

#### Functional

- Can use ``state`` only via ``hooks``.

### Props

System for passing data from a parent to a child component, with the goal of customazing the child (looks or event handling).

- The properties are set up as any other HTML property and can have any name/key.
- The child can access them as the first argument of the function.
- The child can be a component passed as an inner JSX component. It will appear in the parent as ``props.children``. These children can be plain text, JSX components, etc.
- Defataul component props are in ``componentName.defaultProps{}``.

### State

Contains some data only relevant to the component it is in.

- Update/Re-rendering is alsmost real-time when using state.
- Must be initialized when creating the component.
- Can only be updated using the function ``setState()``. Never use direct assignments.
- Additive process. No need to ecify all keys of the dict when updating one of them.

### Hooks

- Add ``state`` and ``lifecycle methods`` to function-based components.
- Make it wasy to share logic between components.

We can import functions from React that allow the use of the class systems (``useState``, ``useEffect`` for lifecycle methods, ``useContext``, ``useRef``, ``useReducer``)

For example, the following code would allow us to set the state for key ``key`` by calling the function ``setKey``. By default we are giving it the value ``value``.

``` JavaScript
    const [key, setKey] = useState('value')
```
In addition, we do not have to take care about the full state object, we do it in a per state value manner. Each call to ``useState`` will only receive a value.

``useEffect`` works at the same time as ``componentDidUpdate`` and ``componentDidMount``. The second parameter (array) is used as a flag/check to know when the function should be called. In order to use it as ``componentDidMount`` it should be set to ``[]`` (empty array). React will compare those object's memory position for equality. 

### Handling user input

- When assigning a callback function in a JSX component we do not put the final ``()`` since that would make the function be called **each time the render function is called**.
- Some callback events: ``onClick``, ``onChange``, ``onSumbit``.
- ``Uncontrolled`` components stores the data outside the *React World* (e.g. in the HTML tag, meaning in the DOM), while ``controlled`` components store it inside the *React World* (e.g. the state object).
- To avoid ``undefined`` errors due to context resolving of ``this``, we can ``bind`` a function in the constructor or using an arrow function (this latter ones have automatic binding).

### REST requests

- ``Axios`` is highly recommended over its lower lever competitor ``fetch``.
- For asynchronous queries we can use the ``.then()`` when working with promises, or mark the function as ``async`` and use the ``await`` primitive.
- ``params`` are additive. You can define some in the ``create`` squeleton and some in the request itself.

### ``Refs``

React ``Refs`` - References - give access to a single DOM element.

1. Create refes in the constructor.
2. Assign them to instance variables.
3. Pass to a particular JSX element as props.

### Exporting

Named exports, i.e. placing ``export`` before the definition of a function, allows to export multiple components/functions from a single file. Meaning there is no need for ``default``.

Named imports need ``{ namedComponent }``.

### React Router Dom

Installing ``react-router-dom``

It works as a ``switch`` of React components depending on the URL path, it does not care about the domain and port (takes everything after the TLD/port). Have to be carefully **one rule can match more than one rule/route** displaying all possible components. By default  it executes a ``contains`` operation. ``Switch`` would make it only show the first matched route.

It contains, internally, a ``History`` object to allow to keep track of the address bar in the browser.

*WARNING* Do not use anchor tags with react-router, it will load a new page and dump all React/Redux state data. Use the ``<Link to={}>to link</link>`` component instead.

The user will load an unique HTML document which will be re-rendered depending on the navigation path he takes. However, it will never re-load (query & dump state) the website.

Types:

- BroweserRouter
- HashRouter: The server will always be wquery nd returned the ``/`` (``index.html``) and everything after the ``#`` will be taken care of by the client.
- MemoryRouter

*WARNING* accessing the history object is quite complicated, therefore if our application needs programmatic navigation we have to create and manage our custom ``history`` object. For this reason we will not use the ``BrowserRouter`` but a generic one. Then we can ``history.push'/new/path'``.

To create pages based on item data we can:
- Create a selectionReducer and record which item is being needed.
- Put the ID of the item in the URL (``URL-Based navigation``).

The second option is preferable. For that we just have to add ``:<name_of_the_param>`` in the routing configuration (in ``App.js``).

The points to take into account for this case are:
- Every component should work by itslef (i.e. fetch its own data). It **must not depend on previous loaded data** (i.e. app state).

### React Portals

A portal allows us to render an element as a child of some element of the DOM structure, usually the body. This would help to circumvent all the stacking (``z-index``) problems that setting up a model implies.

Useful for:
- Modals
- Render React components in a server side application (i.e. on an element that wasn't created by our application).

It is a good practice to create a sibling ``div`` to ``root`` to attach the modals to, in the index file. If they are attached directly to ``root`` its content will be overwritten.

## Redux

Redux is a state management library

- ``redux-thunk`` allows us to perform API queries from the Redux side of our app. Sets two rules:
  - Action Creators **can** return action objects with a *type* property and an optional *payload*.
  - Action Creators **can** return functions. It will be called by ``redux-thunk`` automatically, the action will be re-dispatched later on **manually**.
- ``_.memoize`` takes a function (``_.memoize(functionNameWithoutParenthesis)``) and will return a copy of the passed function but we will call it one time per unique set of arguments. Afterwards it will return the already gotten result. Somehow like a argument value dependent singleton.
- ``Redux Devtools`` allows to debug very easily Redux and its values/status.
- ``Redux Form``: It has many templates to make it easy.

### Redux Cycle

``Action Creator`` --> ``Action`` --> ``Dispatch`` --> ``Middleware`` --> ``Reducers`` --> ``State``

- Action Creator: Person dropping of the form. Tip: Use a ``types.js`` file to avoid mispelling mistakes along the program.
- Action: The form. Must have a ``type``, can optionally contain a ``payload``. **Must be plain objects**, they can not perform any other (async) actions for that it should use ``redux middlewares``. 
- Dispatch: The form receiver. Will make copies of the form and send it to each department (reducers).
- Middleware: Has the ability to stop, modify or otherwise mess around with the actions before they are reduced.
- Reducers: The departments that choose what actions to perform. Rules:
  - Might return anything but ``undefined``.
  - The very first time a reducer is invoked the arguments might be ``undefined``, therefore we should default them to ``null``, empty array, etc.
  - It is supposed to return a value based on the previous state and the action. It **must not perform any other action** (e.g. netowrk request or similar).
  - The rule of thumb is "**Must not mutate** the input argument ``state``. It must set up a new state using the ``setState`` function." This is due to a comparisson performed in *redux/src/combineReducers/~#174* where the old state key is compared to the new. If both states are equal in memory position (i.e. ``!===`` returns false), redux will return the old state and will not notify the components to re-render. Conclusion "**Avoid ``return state;``** and use operation with ``...``, ``Lodash (_)`` library and ``filter or map`` instead of ``pop, push and index assignment``. Note that operations are applied in order, this is of special importance when using ``...``.
- State: The compiled department, in a central repository of data.

### React-Redux

- In order to use Redux inside React we make use of the ``provider`` component and the ``connect`` function.
- When calling ``connect`` we need a second pair of parenthesis in order to call the function returned by it. E.g. ``connect()()``.
-``mapStateToProps`` is called as is by convention. It receives two arguments ``state`` and ``ownProps``, the first is the global state and the second is the props of the class/functional component. 
- ``action creators`` are plain JS functions, but they need to be "dispatched" in order to affect the Redux ``store``. However, by passing the function to ``connect``, it will all happened behind the scenes allowing us to use the function as a normal one.

### Context (React)

**warning** It is not recommended to replace ``Redux`` with ``Context``. However, for trivial applications that only need some data flowing, it could suffice (and therefore be appropriate).

With the ``props`` system we can pass data from parent to child. With the ``context`` system we can pass data from a parent to any nested child.

There are two ways of getting data inside and outside the context.

Input:
- Default data upon definition.
- Create a ``Provider`` object that can push data into de context object. To use a ``Provider`` we have con encapsulate the parent-most compoenent and pass as ``value`` property the data that we wish to pass along (ej. userCreator/App.js). An element can be wrapped in as many providers as needed.

**Warning** Each usage of the context provider object creates a completely separated "pipe" of information. Therefore, a data value update has to be send through every pipe.

Ouput:
- Default data by referencing ``this.context``. In the children we need to hook up the context first (``static`` makes it a class property and ``contextType`` is a reserved keyword).

``` JavaScript
    static contextType = NameOfTheContextComponent;
```
- Create a ``Consumer`` object that can pull data from the context object. To use a ``Consumer`` we have to pass a "child" to it. This child is always going to be a function, will be called automatically with the current value in the pipe. Consumer are used when we need to access more than one context, since by refere we can only access one: ``this.context``.

## Extra: ``map`` statements

A ``map`` function will create a new array applying a function to each one of the elements of the calling array.

``` JavaScript

const numbers = [0, 1, 2, 3, 4];

const mulNumbers = const mulNumbers = numbers.map( (num) => {
    return num * 10;
})

// numbers = [0, 1, 2, 3, 4];
// mulNumbers = [0, 10, 20, 30, 40];
```

Objects can also be flattened. Imagine the case of the object "Person" with attributes "name", "age" and "gender", in the arrow function we can specify only the ones needed and React will do the flattening form "Person" to these attributes.

``` JavaScript
people.map( ({name, age}) => {
    return new Person(name.toUpperCase(), age/10, "No Gender")
})
```